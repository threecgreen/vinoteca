{% extends 'base.html' %}
{% load humanize %}
{% load vinoteca %}

{% block body %}
<div class="container">
  <div class="row">
    <div class="col s10 m11">
      <h3 class="bold">
        {% if flag_exists %}
          <img src="/static/img/flags/{{ region.name }}.svg" alt="Region flag" class="circle z-depth-2 img-responsive region-flag">
        {% endif %}
        {{ region.name }}
      </h3>
    </div>
  </div>
  {% if viti_areas %}
    <div class="row">
      <div class="col s12 m8">
        <h5>Viticultural Areas</h5>
        <table class="highlight responsive condensed">
          <thead>
          <tr>
            <th>Viticultural Area</th>
            <th class="num-col">Wines</th>
            <th class="num-col">Avg Rating</th>
          </tr>
          </thead>
          <tbody>
            {% for viti_area in viti_areas %}
              <tr>
                <td>{{ viti_area.name }}</td>
                <td class="num-col">{{ viti_area.total_quantity }}</td>
                <td class="num-col"> {{ viti_area.avg_rating|floatformat:"2"|defndash }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% endif %}
  <div class="row">
    <div class="col s12">
      <h5>Wines</h5>
      <table class="highlight responsive condensed">
        <thead>
          <tr>
            <th>Last Purchased</th>
            <th>Color</th>
            <th>Name and Type</th>
            <th>Producer</th>
            <th>Description</th>
            <th class="num-col">Total Quantity</th>
            <th class="num-col">Avg Price</th>
            <th class="num-col">Rating</th>
          </tr>
        </thead>
        <tbody>
          {% for wine in wines %}
            <tr>
              <td>
                {% if wine.last_purchased_date %}
                  {{ wine.last_purchased_date|inttodate|naturalday:"b j, Y"|title }}
                {% else %}
                  &ndash;
                {% endif %}
              </td>
              <td>
                {{ wine.color.name|title }}
              </td>
              <td>
                <a href="{% url "Wines:Wine Profile" wine_id=wine.id %}">
                  {{ wine.name|default_if_none:"" }} {{ wine.wine_type.name }}
                </a>
              </td>
              <td>
                <a href="{% url "Producers:Producer Profile" producer_id=wine.producer.id %}">
                  {{ wine.producer.name }}
                </a>
              </td>
              <td>
                {{ wine.description|default_if_none:"" }}
              </td>
              <td class="num-col">
                {{ wine.total_quantity|defndash }}
              </td>
              <td class="num-col">
                {{ wine.avg_price|floatformat:"2"|defndash }}
              </td>
              <td class="num-col">
                {{ wine.rating|defndash }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
