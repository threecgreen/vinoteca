{% extends 'base.html' %}
{% load static %}

{% block dashboard-nav %}class="active"{% endblock %}

{% block body %}
<div class="container">
    <div class="row">
        <div class="col s12">
            <h3>Wine Purchase Stats</h3>
        </div>
    </div>
    <div class="row dashboard-row">
        <div class="col s12 l6 xl4">
            <div class="card wine-red-card">
                <div class="card-content">
                    <h2 class="card-title">Purchases by Color</h2>
                    {% include "colors.html" %}
                </div>
            </div>
            <div class="card wine-green-card">
                <div class="card-content">
                    <h2 class="card-title">Purchases by Region</h2>
                    {% include "regions.html" %}
                </div>
            </div>
        </div>
        <div class="col s12 l6 xl4">
            <div class="card golden-yellow-card">
                <div class="card-content">
                    <h2 class="card-title">By the Numbers</h2>
                    {% include "by_the_numbers.html" %}
                </div>
            </div>
            <div class="card wine-red-card">
                <div class="card-content">
                    <h2 class="card-title">Top Producers</h2>
                    {% include "producers.html" %}
                </div>
            </div>
        </div>
        <div class="col s12 l6 xl4">
            <div class="card wine-green-card">
                <div class="card-content">
                    <h2 class="card-title">Purchases by Year</h2>
                    {% include "purchases_by_year.html" %}
                </div>
            </div>
        </div>
    </div>
    <div class="row dashboard-row">
        <div class="col s12 xl7">
            <div class="card golden-yellow-card dashboard-top-card">
                <div class="card-content">
                    <h2 class="card-title">Recent Purchases</h2>
                    {% include "recent_purchases.html" %}
                </div>
            </div>
        </div>
        <div class="col s12 xl5">
            <div class="card wine-red-card dashboard-top-card">
                <div class="card-content">
                    <h2 class="card-title">Top Purchase Types</h2>
                    {% include "top_purchase_wine_types.html" %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block js %}
<script src="{% static "js/Chart.bundle.min.js" %}"></script>
<script type="module">
import { tabs } from '{% static "js/widgets.js" %}'
import { barChart, applyChart, setChartAccessibility } from "{% static "js/wine_charts.js" %}";
import { pipe } from '{% static "js/utils.js" %}'

$(function () {
    tabs();

    // Colors
    pipe({
        {% for color in colors %}
            "{{ color.name|title }}": {{ color.quantity|default_if_none:0 }},
        {% endfor %}
    }).chain(
        applyChart(barChart, $("#colors-purchases-chart"))
    ).chain(
        setChartAccessibility($("#colors-purchases-chart-li"))
    );
    pipe({
        {% for color in colors %}
            "{{ color.name|title }}": {{ color.variety|default_if_none:0 }},
        {% endfor %}
    }).chain(
        applyChart(barChart, $("#colors-varieties-chart"))
    ).chain(
        setChartAccessibility($("#colors-varieties-chart-li"))
    );
    pipe({
        {% for color in colors %}
            "{{ color.name|title }}": {{ color.avg_price|floatformat:2 }},
        {% endfor %}
    }).chain(
        applyChart(barChart, $("#colors-avg-price-chart"))
    ).chain(
        setChartAccessibility($("#colors-avg-price-chart-li"))
    );

    // Top Wine Types
    pipe({
         {% for wine_type in top_wine_types %}
             "{{ wine_type.wine_type }}": {{ wine_type.quantity|default_if_none:0 }},
         {% endfor %}
    }).chain(
        applyChart(barChart, $("#top-purchases-chart"))
    ).chain(
        setChartAccessibility($("#top-purchases-chart-li"))
    );
    pipe({
        {% for wine_type in top_wine_types %}
            "{{ wine_type.wine_type }}": {{ wine_type.variety|default_if_none:0 }},
        {% endfor %}
    }).chain(
        applyChart(barChart, $("#top-varieties-chart"))
    ).chain(
        setChartAccessibility($("#top-varieties-chart-li"))
    );
    pipe({
        {% for wine_type in top_wine_types %}
            "{{ wine_type.wine_type }}": {{ wine_type.avg_price|floatformat:2 }},
        {% endfor %}
    }).chain(
        applyChart(barChart, $("#avg-price-chart"))
    ).chain(
        setChartAccessibility($("#avg-price-chart-li"))
    );
});
</script>
{% endblock %}
