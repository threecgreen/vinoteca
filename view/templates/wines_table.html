{% extends 'base.html' %}
{% load static %}
{% block head %}
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">
{% endblock %}

{% block view-nav %}class="active"{% endblock %}
{% block body %}
<div class="container">
    <div class="row">
        <div class="col s12">
            <h3>Wines</h3>
            <button class="btn reset yellow darken-2">Reset Filters</button>
            <table class="highlight responsive sortable tablesorter condensed">
                <thead>
                    <tr>
                        <th class="filter-select filter-exact" data-placeholder="Select a color">Color</th>
                        <th class="num-col">Inventory</th>
                        <th>Name</th>
                        <th>Producer</th>
                        <th>Region</th>
                        <th>Viticultural Area</th>
                        <th class="num-col">Vintage</th>
                        <th>Description</th>
                        <th class="num-col">Rating</th>
                    </tr>
                </thead>
                <tfoot>
                    <!-- include "tablesorter-ignoreRow" class for pager rows in thead -->
                    <tr class="tablesorter-ignoreRow">
                        <th colspan="9" class="ts-pager form-horizontal center">
                            <button type="button" class="btn first"><i class="small material-icons">first_page</i></button>
                            <button type="button" class="btn prev"><i class="small material-icons">navigate_before</i></button>
                            <span class="pagedisplay"></span>
                            <!-- this can be any element, including an input -->
                            <button type="button" class="btn next"><i class="small material-icons">navigate_next</i></button>
                            <button type="button" class="btn last"><i class="small material-icons">last_page</i></button>
                            <select class="pagesize col s" title="Select page size" id="pagesize-sel">
                                <option value="25">25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </th>
                    </tr>
                </tfoot>
                <tbody>
                    {% for wine in wines %}
                    <tr>
                        <td><a href="{% url "Wine Profile" wine_id=wine.id %}">{{ wine.type|default_if_none:""|title }}</a></td>
                        <td class="num-col"><a href="{% url "Wine Profile" wine_id=wine.id %}">{{ wine.inventory }}</a></td>
                        <td><a href="{% url "Wine Profile" wine_id=wine.id %}">{{ wine.name }}</a></td>
                        <td><a href="{% url "Wine Profile" wine_id=wine.id %}">{{ wine.producer }}</a></td>
                        <td><a href="{% url "Wine Profile" wine_id=wine.id %}">{{ wine.region }}</a></td>
                        <td><a href="{% url "Wine Profile" wine_id=wine.id %}">{{ wine.viti_area|default_if_none:"" }}</a></td>
                        <td class="num-col"><a href="{% url "Wine Profile" wine_id=wine.id %}">{{ wine.vintage|default_if_none:"NV" }}</a></td>
                        <td><a href="{% url "Wine Profile" wine_id=wine.id %}">{{ wine.description|default_if_none:"" }}</a></td>
                        <td class="num-col"><a href="{% url "Wine Profile" wine_id=wine.id %}">{{ wine.rating|default_if_none:"" }}</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
    <script src="{% static "js/jquery.tablesorter.js" %}"></script>
    <script src="{% static "js/jquery.tablesorter.widgets.js" %}"></script>
    <!-- pager plugin -->
    <link rel="stylesheet" href="{% static "css/jquery.tablesorter.pager.css" %}">
    <script src="{% static "js/jquery.tablesorter.pager.js" %}"></script>

    <script type="text/javascript">
    var $table = $("table");
    $(function() {
        $table.tablesorter({
            theme : "materialize",

            widthFixed: true,
            // widget code contained in the jquery.tablesorter.widgets.js file
            widgets : [ "filter"],

            widgetOptions : {
                // reset filters button
                filter_reset : ".reset",
                {#filter_searchDelay: 500,#}
                filter_ignoreCase: true,
                // extra css class name (string or array) added to the filter element (input or select)
                // select needs a "browser-default" class or it gets hidden
                filter_cssFilter: ["browser-default"]
            }
        })
        .tablesorterPager({

            // target the pager markup - see the HTML block below
            container: $(".ts-pager"),

            // target the pager page select dropdown - choose a page
            cssGoto: ".pagenum",

            // remove rows from the table to speed up the sort of large tables.
            // setting this to false, only hides the non-visible rows; needed if you plan to add/remove rows with the pager enabled.
            removeRows: false,

            // output string - default is '{page}/{totalPages}';
            // possible variables: {page}, {totalPages}, {filteredPages}, {startRow}, {endRow}, {filteredRows} and {totalRows}
            size: 100
        })
        .bind('filterInit', function() {
            // check that storage ulility is loaded
            if ($.tablesorter.storage) {
                // get saved filters
                var f = $.tablesorter.storage(this, 'tablesorter-filters') || [];
                $(this).trigger('search', [f]);
            }
        })
        .bind('filterEnd', function(){
            if ($.tablesorter.storage) {
                // save current filters
                var f = $(this).find('.tablesorter-filter').map(function(){
                    return $(this).val() || '';
                }).get();
                $.tablesorter.storage(this, 'tablesorter-filters', f);
            }
        })
    });
    $(document).ready(function () {
        $('select').material_select();
        $('#pagesize-sel').val("50");
    });
    </script>
{% endblock %}
